<!DOCTYPE html>
<html>
	<head>
		<title>P</title>

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.0.0-beta12/howler.min.js"></script>
		<script type="text/javascript">
			var Instrument = function (palettes, sounds, duration) {
				this.palettes = palettes;
				this.sounds = 9;
				this.duration = duration * 1000;
				this.soundPalette = 0;
			};
			Instrument.prototype = {
				play: function (sound) {
					this.palettes[this.soundPalette].play(sound.toString());
				}
			};

			var Song = function (instruments) {
				this.instruments = instruments;
				this.tempo = 1 * 1000;
				this.lenght = 4;
				this.step = 0;

				var self = this;

				/**
				 * Array con instrumentos.
				 * Cada instrumento es un array con los pasos.
				 * Cada paso tiene un array con las notas a reproducir.
				 */
				this.notes = [instruments.map(function () {
					return new Array(self.lenght);
				})];
			};
			Song.prototype = {
				advanceStep: function () {
					this.step = this.step === this.lenght - 1 ? 0 : this.step + 1;
				},

				play: function () {
					var self = this;
/*
					console.group('> play step', this.step);

					this.notes


					this.advanceStep();
					console.groupEnd();

					setTimeout(function () {
						self.play();
					}, this.tempo);
					//*/
				}
			};


			var piano = new Instrument([
					new Howl({
						src: ['/audio/morning_sprite_lowest.mp3'],
						volume: 1,
						sprite: {
							1: [0, 3000],
							2: [4000, 3000],
							3: [8000, 3000],
							4: [12000, 3000],
							5: [16000, 3000],
							6: [20000, 3000],
							7: [24000, 3000],
							8: [28000, 3000],
							9: [32000, 3000]
						}
					})
				], 9, 1),
				violin = new Instrument([
					new Howl({
						src: ['/audio/morning_sprite_lowest.mp3'],
						volume: 1,
						sprite: {
							1: [35000, 8500],
							2: [45000, 8500],
							3: [54000, 8500],
							4: [65000, 8500],
							5: [75000, 8500],
							6: [84000, 8500],
							7: [95000, 8500],
							8: [105000, 8500],
							9: [114000, 8500]
						}
					})
				], 9, 16);

			var s = new Song([piano, violin]);


			s.play();
		</script>
	</head>
	<body>

	</body>
</html>
